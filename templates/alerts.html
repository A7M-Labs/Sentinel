{% extends 'base.html' %}

{% block title %}Sentinel - Alerts{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-6">
        <h2 class="mb-4"><i class="bi bi-exclamation-triangle-fill text-primary me-2"></i> Alerts</h2>
    </div>
    <div class="col-md-6 text-end">
        <div class="btn-group">
            <button type="button" class="btn btn-outline-secondary">
                <i class="bi bi-filter me-1"></i> Filter
            </button>
            <button type="button" class="btn btn-outline-secondary">
                <i class="bi bi-sort-down me-1"></i> Sort
            </button>
            <button type="button" class="btn btn-outline-secondary">
                <i class="bi bi-download me-1"></i> Export
            </button>
        </div>
    </div>
</div>

<!-- Alert Filters -->
<div class="dashboard-card p-3 mb-4">
    <div class="row g-3">
        <div class="col-md-3">
            <label for="dateRange" class="form-label">Date Range</label>
            <select class="form-select" id="dateRange">
                <option value="today" selected>Today</option>
                <option value="yesterday">Yesterday</option>
                <option value="week">Last 7 Days</option>
                <option value="month">Last 30 Days</option>
                <option value="custom">Custom Range</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="eventType" class="form-label">Event Type</label>
            <select class="form-select" id="eventType">
                <option value="all" selected>All Types</option>
                <option value="unauthorized">Unauthorized Entry</option>
                <option value="unattended">Unattended Object</option>
                <option value="suspicious">Suspicious Behavior</option>
                <option value="motion">Motion Detected</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="location" class="form-label">Location</label>
            <select class="form-select" id="location">
                <option value="all" selected>All Locations</option>
                <option value="front">Front Door</option>
                <option value="lobby">Lobby</option>
                <option value="parking">Parking Lot</option>
                <option value="back">Back Entrance</option>
                <option value="storage">Storage Room</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="confidence" class="form-label">Min. Confidence</label>
            <input type="range" class="form-range" min="0" max="100" value="60" id="confidence">
            <div class="d-flex justify-content-between">
                <small>0.0</small>
                <small id="confidenceValue">0.6</small>
                <small>1.0</small>
            </div>
        </div>
    </div>
</div>

<!-- Alerts Table -->
<div class="dashboard-card p-3 mb-4">
    <div class="table-responsive">
        <table class="table table-dark table-hover">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Event Type</th>
                    <th>Location</th>
                    <th>Confidence</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                <tr>
                    <td>{{ event.timestamp }}</td>
                    <td>
                        {% if event.type == 'Unauthorized Entry' %}
                            <span class="badge bg-danger">{{ event.type }}</span>
                        {% elif event.type == 'Unattended Object' %}
                            <span class="badge bg-warning text-dark">{{ event.type }}</span>
                        {% elif event.type == 'Suspicious Behavior' %}
                            <span class="badge bg-danger">{{ event.type }}</span>
                        {% else %}
                            <span class="badge bg-primary">{{ event.type }}</span>
                        {% endif %}
                    </td>
                    <td>{{ event.camera }}</td>
                    <td>{{ event.confidence }}</td>
                    <td><span class="badge bg-secondary">New</span></td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-light" title="View">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-light" title="Acknowledge">
                                <i class="bi bi-check-lg"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-light" title="Dismiss">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Alert Details Modal (would be triggered by the View button) -->
<div class="modal fade" id="alertDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header">
                <h5 class="modal-title">Alert Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="camera-feed mb-3">
                            <img src="{{ url_for('static', filename='img/placeholder-camera.jpg') }}" alt="Event Screenshot" class="img-fluid">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>Event Information</h5>
                        <table class="table table-dark">
                            <tr>
                                <th>Event ID:</th>
                                <td>EVT-20231001-001</td>
                            </tr>
                            <tr>
                                <th>Type:</th>
                                <td>Unauthorized Entry</td>
                            </tr>
                            <tr>
                                <th>Location:</th>
                                <td>Front Door</td>
                            </tr>
                            <tr>
                                <th>Timestamp:</th>
                                <td>2023-10-01 08:45:32</td>
                            </tr>
                            <tr>
                                <th>Confidence:</th>
                                <td>0.89</td>
                            </tr>
                            <tr>
                                <th>Status:</th>
                                <td>New</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h5>Actions</h5>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary">
                            <i class="bi bi-check-circle me-1"></i> Acknowledge
                        </button>
                        <button class="btn btn-outline-warning">
                            <i class="bi bi-flag-fill me-1"></i> Flag as Important
                        </button>
                        <button class="btn btn-outline-danger">
                            <i class="bi bi-exclamation-triangle-fill me-1"></i> Escalate
                        </button>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h5>Notes</h5>
                    <textarea class="form-control bg-dark text-light" rows="3" placeholder="Add notes about this event..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>

{% block additional_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Confidence slider
        const confidenceSlider = document.getElementById('confidence');
        const confidenceValue = document.getElementById('confidenceValue');
        
        if (confidenceSlider && confidenceValue) {
            confidenceSlider.addEventListener('input', function() {
                const value = (this.value / 100).toFixed(1);
                confidenceValue.textContent = value;
            });
        }
        
        // Initialize any view buttons to open the modal
        document.querySelectorAll('button[title="View"]').forEach(btn => {
            btn.addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.getElementById('alertDetailsModal'));
                modal.show();
            });
        });
    });
</script>
{% endblock %}
{% endblock %} 